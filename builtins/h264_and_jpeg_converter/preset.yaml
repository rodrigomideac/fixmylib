name: h264_and_jpeg_converter
description: "Convert to h264 and JPEG for compatibility. Uses VA-API for hardware transcoding at ffmpeg"
args:
  - name: input_folder
    description: Folder to be processed
  - name: concurrency
    description: Concurrency for scripts
  - name: working_dir
    description: Destination folder, which will also be used as working directory for the scripts.
  - name: jpeg_quality
    description: JPEG quality for convert_photo.sh
  - name: concurrency_video_conversion
    description: Concurrency for video conversion
scans:
  - iterate_on: folders
    scripts:
      - name: create_folder_structure.sh
  - iterate_on: files
    concurrency: <&concurrency_video_conversion>
    scripts:
      - name: convert_h265.sh
        target_extensions: MOV,MKV,MP4
  - iterate_on: files
    scripts:
      - name: convert_photo.sh
        target_extensions: HEIC,JPG,JPEG,PNG
      - name: copy_others.sh
        exclude_extensions: HEIC,JPG,JPEG,PNG,MOV,MKV,MP4
  - iterate_on: folders
    scripts:
      - name: copy_folder_timestamp.sh
